(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[144],{509:function(e,t,s){Promise.resolve().then(s.bind(s,3937))},3937:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return v}});var a=s(7573),l=s(7653),n=s(1695),i=s(269),o=s(8102);let r=(0,o.Z)("messages-square",[["path",{d:"M16 10a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 14.286V4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z",key:"1n2ejm"}],["path",{d:"M20 9a2 2 0 0 1 2 2v10.286a.71.71 0 0 1-1.212.502l-2.202-2.202A2 2 0 0 0 17.172 19H10a2 2 0 0 1-2-2v-1",key:"1qfcsi"}]]);var d=s(4878);let c=(0,o.Z)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),u=(0,o.Z)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var m=s(3458),x=s(1493),p=s(3233),f=s(8941),h=s(466);function v(){var e;let t=(0,n.useParams)(),s="string"==typeof t.toolSessionId?t.toolSessionId:"",{locale:o}=(0,p.Q)(),v=(0,l.useMemo)(()=>"zh"===o?{title:"工具会话中心",subtitle:"统一查看本地扫描会话与系统已连接会话。",refresh:"刷新",all:"全部",codex:"Codex",claude:"Claude Code",collabTag:"协作创建",userTag:"用户打开",localTag:"本地私有",active:"活跃",paused:"暂停",transcriptTitle:"会话记录",noTranscript:"暂无可展示记录。",openDrawer:"查看记录",sourceFilter:"来源筛选",sourceAll:"全部",sourceLocal:"本地扫描",sourceLinked:"系统已连接",providerFilter:"工具",importBtn:"导入",importedOk:"导入成功",importFail:"导入失败",prev:"上一页",next:"下一页",page:"页",of:"共",emptyList:"当前筛选条件下没有会话。"}:{title:"Tool Session Hub",subtitle:"View local scanned sessions and linked sessions in one list.",refresh:"Refresh",all:"All",codex:"Codex",claude:"Claude Code",collabTag:"From collab",userTag:"Opened by user",localTag:"Local private",active:"Active",paused:"Paused",transcriptTitle:"Transcript",noTranscript:"No transcript entries.",openDrawer:"Open transcript",sourceFilter:"Source Filter",sourceAll:"All",sourceLocal:"Local Scanned",sourceLinked:"Linked",providerFilter:"Provider",importBtn:"Import",importedOk:"Imported",importFail:"Import failed",prev:"Prev",next:"Next",page:"Page",of:"of",emptyList:"No sessions under current filters."},[o]),[k,j]=(0,l.useState)("all"),[g,b]=(0,l.useState)("all"),[N,y]=(0,l.useState)([]),[w,S]=(0,l.useState)([]),[I,C]=(0,l.useState)(null),[z,_]=(0,l.useState)(!1),[T,L]=(0,l.useState)([]),[A,E]=(0,l.useState)(""),[P,M]=(0,l.useState)(1),[F,D]=(0,l.useState)(!1),O=(0,l.useMemo)(()=>{let e=[];if("all"===g||"local"===g)for(let t of w)e.push({kind:"local",data:t});if("all"===g||"linked"===g)for(let t of N)e.push({kind:"linked",data:t});return e.sort((e,t)=>Date.parse(t.data.lastActiveAt)-Date.parse(e.data.lastActiveAt))},[g,w,N]),Z=Math.max(1,Math.ceil(O.length/8)),K=(0,l.useMemo)(()=>O.slice((P-1)*8,8*P),[O,P]);async function R(){let e=await (0,x.LK)("all"===k?"/v1/tool-sessions":"/v1/tool-sessions?provider=".concat(k));return y(e),e}async function V(){let e=await (0,x.LK)("all"===k?"/v1/local-tool-sessions?limit=300":"/v1/local-tool-sessions?provider=".concat(k,"&limit=300"));return S(e),e}async function B(){let[e,t]=await Promise.all([R(),V()]);if(I){if("linked"===I.kind){let t=e.find(e=>e.toolSessionId===I.data.toolSessionId);if(t){C({kind:"linked",data:t});return}}if("local"===I.kind){let e=t.find(e=>e.toolSessionId===I.data.toolSessionId&&e.provider===I.data.provider);if(e){C({kind:"local",data:e});return}}}let a=e.find(e=>e.toolSessionId===s);if(a){C({kind:"linked",data:a});return}let l=t.find(e=>e.toolSessionId===s);if(l){C({kind:"local",data:l});return}if(e.length>0){C({kind:"linked",data:e[0]});return}if(t.length>0){C({kind:"local",data:t[0]});return}C(null)}async function H(e){var t,s;if("linked"===e.kind){L((null!==(t=(await (0,x.LK)("/v1/collab-sessions/".concat(encodeURIComponent(e.data.collabSessionId),"/tool-sessions/").concat(encodeURIComponent(e.data.toolSessionId),"/peek?limit=100"))).entries)&&void 0!==t?t:[]).map(e=>({role:"system",text:e})));return}L(null!==(s=(await (0,x.LK)("/v1/local-tool-sessions/".concat(e.data.provider,"/").concat(encodeURIComponent(e.data.toolSessionId),"/transcript?limit=300"))).entries)&&void 0!==s?s:[])}function U(e){return"COLLAB"===e?v.collabTag:v.userTag}async function q(e){try{await (0,x.uz)("/v1/tool-sessions",{collab_session_id:"user_manual",task_id:"task_import_".concat(Date.now()),provider:e.provider,source:"USER_OPENED",tool_session_id:e.toolSessionId,summary_150:e.summary150}),E(v.importedOk),await B()}catch(t){let e=t instanceof Error?t.message:v.importFail;E("".concat(v.importFail,": ").concat(e))}}(0,l.useEffect)(()=>{B()},[k,s]),(0,l.useEffect)(()=>{P>Z&&M(Z)},[P,Z]),(0,l.useEffect)(()=>{M(1)},[k,g]),(0,l.useEffect)(()=>{if(!I){L([]);return}H(I)},[null==I?void 0:I.kind,null==I?void 0:I.data.toolSessionId]),(0,l.useEffect)(()=>{D(!0)},[]);let Q=F&&z?(0,m.createPortal)((0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{type:"button","aria-label":"close drawer backdrop",className:"fixed inset-0 z-40 bg-black/20",onClick:()=>_(!1)}),(0,a.jsx)("aside",{className:"fixed inset-y-0 right-0 z-50 h-screen w-full border-l bg-white shadow-2xl transition-transform duration-300 sm:w-[80%] lg:w-1/2 lg:min-w-[640px]",children:(0,a.jsxs)("div",{className:"flex h-full flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between border-b px-5 py-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:v.transcriptTitle}),(0,a.jsx)("h3",{className:"text-lg font-bold",children:null!==(e=null==I?void 0:I.data.toolSessionId)&&void 0!==e?e:"-"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:(null==I?void 0:I.kind)==="local"?v.localTag:(null==I?void 0:I.kind)==="linked"?U(I.data.source):"-"})]}),(0,a.jsx)(h.z,{variant:"ghost",size:"icon",onClick:()=>_(!1),children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex-1 space-y-2 overflow-y-auto p-5",children:[(null==I?void 0:I.kind)==="linked"?(0,a.jsx)("div",{className:"rounded-xl border bg-muted/40 p-3",children:(0,a.jsx)("p",{className:"text-sm",children:I.data.lastSummary150||"-"})}):null,(null==I?void 0:I.kind)==="local"?(0,a.jsxs)("div",{className:"rounded-xl border bg-muted/40 p-3",children:[(0,a.jsx)("p",{className:"text-sm",children:I.data.summary150||"-"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:I.data.cwd||I.data.sourcePath})]}):null,0===T.length?(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:v.noTranscript}):null,T.map((e,t)=>(0,a.jsxs)("div",{className:"rounded-xl border p-3",children:[(0,a.jsxs)("div",{className:"mb-1 flex items-center gap-2 text-xs text-muted-foreground",children:[(0,a.jsx)(r,{className:"h-3.5 w-3.5"}),e.role,e.timestamp?(0,a.jsxs)("span",{children:["\xb7 ",e.timestamp]}):null]}),(0,a.jsx)("p",{className:"whitespace-pre-wrap text-sm",children:e.text})]},"".concat(t,"_").concat(e.text.slice(0,20))))]})]})})]}),document.body):null;return(0,a.jsxs)("section",{className:"relative",children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-extrabold",children:v.title}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:v.subtitle})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)(h.z,{variant:"all"===g&&"all"===k?"default":"outline",size:"sm",onClick:()=>{b("all"),j("all")},children:v.sourceAll}),(0,a.jsx)(h.z,{variant:"linked"===g?"default":"outline",size:"sm",onClick:()=>b("linked"),children:v.sourceLinked}),(0,a.jsx)(h.z,{variant:"codex"===k?"default":"outline",size:"sm",onClick:()=>j("codex"),children:v.codex}),(0,a.jsx)(h.z,{variant:"claude_code"===k?"default":"outline",size:"sm",onClick:()=>j("claude_code"),children:v.claude}),(0,a.jsxs)(h.z,{variant:"outline",size:"sm",onClick:()=>void B(),children:[(0,a.jsx)(d.Z,{className:"mr-2 h-4 w-4"}),v.refresh]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[A?(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:A}):null,0===O.length?(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:v.emptyList}):null,K.map((e,t)=>{let s=e.data,l="local"===e.kind;return(0,a.jsxs)("div",{role:"button",tabIndex:0,className:"flex cursor-pointer items-center justify-between rounded-xl border p-3 ".concat(I&&I.kind===e.kind&&("local"===e.kind?I.data.toolSessionId===e.data.toolSessionId&&I.data.provider===e.data.provider:I.data.toolSessionId===e.data.toolSessionId)?"border-primary bg-primary/5":""),onClick:()=>{C(e),_(!0)},onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),C(e),_(!0))},children:[(0,a.jsxs)("div",{className:"min-w-0 flex-1 text-left",children:[(0,a.jsx)("p",{className:"truncate font-semibold",children:s.toolSessionId}),(0,a.jsxs)("p",{className:"truncate text-xs text-muted-foreground",children:[s.provider," \xb7 ",l?s.cwd||s.sourcePath:s.collabSessionId]}),(0,a.jsxs)("div",{className:"mt-1 flex gap-2",children:[(0,a.jsx)(f.C,{variant:"outline",children:l?v.localTag:U(s.source)}),l?null:(0,a.jsx)(f.C,{variant:"ACTIVE"===s.status?"default":"secondary",children:"ACTIVE"===s.status?v.active:v.paused})]})]}),(0,a.jsxs)("div",{className:"ml-3 flex items-center gap-2",children:[l?(0,a.jsxs)(h.z,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),q(s)},children:[(0,a.jsx)(c,{className:"mr-2 h-3.5 w-3.5"}),v.importBtn]}):null,(0,a.jsx)(h.z,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),C(e),_(!0)},children:v.openDrawer}),(0,a.jsx)(u,{className:"h-4 w-4 text-muted-foreground"})]})]},"".concat(e.kind,"_").concat(s.toolSessionId,"_").concat(t))}),O.length>0?(0,a.jsxs)("div",{className:"flex items-center justify-between border-t pt-3",children:[(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[v.page," ",P," ",v.of," ",Z]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(h.z,{variant:"outline",size:"sm",disabled:P<=1,onClick:()=>M(e=>Math.max(1,e-1)),children:v.prev}),(0,a.jsx)(h.z,{variant:"outline",size:"sm",disabled:P>=Z,onClick:()=>M(e=>Math.min(Z,e+1)),children:v.next})]})]}):null]})]}),Q]})}},269:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(8102).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},function(e){e.O(0,[113,461,293,528,744],function(){return e(e.s=509)}),_N_E=e.O()}]);