## Context

当前前端在单一页面混合展示协作会话管理、会话聊天与工具会话查看，导致主任务路径不明确。系统已经具备工具会话桥接与 HITL 能力，但缺乏稳定的页面信息架构与会话生命周期交互规范。

## Goals / Non-Goals

**Goals:**
- 建立双页面结构：会话管理页与会话聊天页。
- 在会话聊天页显式展示执行上下文（路径、工具、绑定会话）。
- 保持协作轨与工具轨分离，工具完整 transcript 通过独立抽屉查看。
- 建立会话归档状态流转与默认列表筛选行为。

**Non-Goals:**
- 不改造 Codex/Claude 的底层 session 管理机制。
- 不实现多级审批或复杂权限模型。
- 不在本次变更实现“单句需求自动生成标题描述”的完整 LLM 工作流，仅预留接口位点。

## Decisions

1. 页面职责拆分
- 决策：`/sessions` 只做会话管理；`/sessions/{id}` 只做会话执行。
- 理由：降低页面状态复杂度，避免“列表筛选状态”与“聊天上下文状态”互相干扰。
- 备选：保持单页多面板；缺点是状态耦合高且移动端体验差。

2. 会话列表项固定三动作
- 决策：每个会话固定 `进入会话`、`详情`、`归档`。
- 理由：MVP 保持可预期操作集合，减少用户学习成本。
- 备选：将详情合并到进入页；缺点是管理场景下查阅效率下降。

3. 工具内容呈现策略
- 决策：协作时间线仅显示工具卡片（摘要、状态、引用），点击后在 body 级右侧抽屉查看 transcript。
- 理由：保持协作聊天可读性，避免工具长输出淹没决策信息。
- 备选：直接插入 transcript；缺点是主轨噪声高、回看困难。

4. 抽屉渲染规格
- 决策：右侧抽屉固定全屏高度，默认宽度约 50% 视口。
- 理由：保证可用阅读宽度并保持主页面上下文感。
- 备选：组件内弹窗；缺点是受容器限制，滚动与布局冲突明显。

5. 归档语义
- 决策：归档仅改变协作会话状态为 `ARCHIVED`，不删除工具会话实体。
- 理由：保护可追溯性并避免误删执行上下文。
- 备选：硬删除；缺点是不可恢复且影响审计链路。

## Risks / Trade-offs

- [页面拆分带来路由改造成本] -> 通过复用现有会话查询接口并逐步迁移状态管理，降低一次性改动风险。
- [工具卡片信息不足导致排障慢] -> 在卡片中强制包含 run_id、时间戳、状态与“查看详情”入口。
- [归档误操作导致会话不可见] -> 归档前二次确认，并提供“显示已归档”筛选恢复访问。
- [后续 LLM 自动生成字段引入不确定性] -> 创建弹窗默认人工可编辑并以用户提交值为准。

## Migration Plan

1. 先上线会话列表页与会话聊天页路由拆分，保留旧入口跳转兼容。
2. 上线工具卡片 + body 级抽屉，替换旧的组件内弹窗查看方式。
3. 启用归档状态筛选，默认活跃会话视图。
4. 观察一轮使用反馈后再接入“单句需求 -> 名称描述草稿”能力。

## Open Questions

- 会话详情弹窗是否需要支持自定义字段分组配置，还是先固定常用字段。
- 归档后是否允许直接在聊天页继续发送消息，或必须先“恢复会话”。
- 工具卡片是否需要支持多条 transcript 片段聚合视图（按 run 分组）。
